<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ | RegenMed Consulting</title>
    <link rel="stylesheet" href="../style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        .admin-container { max-width: 1200px; margin: 0 auto; padding: 120px 20px 60px; }
        .admin-header { margin-bottom: 40px; }
        .admin-header h1 { font-size: 28px; font-weight: 800; color: #1F2937; margin-bottom: 8px; }
        .admin-header p { color: #4A5568; font-size: 15px; }
        .admin-stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 40px; }
        .stat-card { background: #fff; border-radius: 16px; padding: 24px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); }
        .stat-card .stat-label { font-size: 13px; color: #6B7280; margin-bottom: 8px; }
        .stat-card .stat-value { font-size: 32px; font-weight: 800; color: #004DA6; }
        .stat-card .stat-sub { font-size: 12px; color: #9CA3AF; margin-top: 4px; }
        .admin-table-wrap { background: #fff; border-radius: 16px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); overflow: hidden; }
        .admin-table-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-bottom: 1px solid #E5E7EB; }
        .admin-table-header h2 { font-size: 18px; font-weight: 700; color: #1F2937; }
        .btn-clear-data { background: #E17055; color: #fff; border: none; padding: 8px 16px; border-radius: 8px; font-size: 13px; cursor: pointer; font-weight: 600; }
        .btn-clear-data:hover { background: #D63031; }
        .admin-table { width: 100%; border-collapse: collapse; }
        .admin-table th { background: #F9FAFB; padding: 12px 16px; text-align: left; font-size: 13px; font-weight: 600; color: #6B7280; border-bottom: 1px solid #E5E7EB; white-space: nowrap; }
        .admin-table td { padding: 14px 16px; font-size: 14px; color: #374151; border-bottom: 1px solid #F3F4F6; }
        .admin-table tr:hover td { background: #F9FAFB; }
        .grade-tag { display: inline-block; padding: 3px 10px; border-radius: 20px; font-size: 12px; font-weight: 700; }
        .grade-tag.grade-a { background: #D1FAE5; color: #065F46; }
        .grade-tag.grade-b { background: #FEF3C7; color: #92400E; }
        .grade-tag.grade-c { background: #FEE2E2; color: #991B1B; }
        .score-bar-mini { width: 80px; height: 6px; background: #E5E7EB; border-radius: 3px; display: inline-block; vertical-align: middle; margin-right: 8px; }
        .score-bar-mini-fill { height: 100%; border-radius: 3px; }
        .no-data { padding: 60px 20px; text-align: center; color: #9CA3AF; font-size: 15px; }
        .detail-btn { background: #004DA6; color: #fff; border: none; padding: 6px 12px; border-radius: 6px; font-size: 12px; cursor: pointer; }
        .detail-btn:hover { background: #003D7A; }
        /* ëª¨ë‹¬ */
        .admin-modal-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 9999; justify-content: center; align-items: center; }
        .admin-modal-overlay.active { display: flex; }
        .admin-modal { background: #fff; border-radius: 20px; max-width: 600px; width: 90%; max-height: 80vh; overflow-y: auto; padding: 32px; }
        .admin-modal h3 { font-size: 20px; font-weight: 700; margin-bottom: 20px; color: #1F2937; }
        .modal-info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 24px; }
        .modal-info-item { padding: 12px; background: #F9FAFB; border-radius: 8px; }
        .modal-info-item .label { font-size: 12px; color: #6B7280; margin-bottom: 4px; }
        .modal-info-item .value { font-size: 14px; font-weight: 600; color: #1F2937; }
        .modal-score-section { margin-bottom: 20px; }
        .modal-score-section h4 { font-size: 15px; font-weight: 600; margin-bottom: 12px; color: #374151; }
        .modal-part-row { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
        .modal-part-label { width: 120px; font-size: 13px; color: #4A5568; }
        .modal-part-bar { flex: 1; height: 8px; background: #E5E7EB; border-radius: 4px; }
        .modal-part-bar-fill { height: 100%; border-radius: 4px; }
        .modal-part-score { font-size: 13px; font-weight: 600; width: 50px; text-align: right; }
        .modal-close { background: #E5E7EB; color: #374151; border: none; padding: 10px 24px; border-radius: 8px; font-size: 14px; cursor: pointer; font-weight: 600; margin-top: 16px; }
        .modal-close:hover { background: #D1D5DB; }
        .modal-note { margin-top: 16px; padding: 12px; background: #FFFBEB; border-radius: 8px; font-size: 13px; color: #92400E; }
        /* íƒ­ */
        .admin-tabs { display: flex; gap: 4px; margin-bottom: 0; background: #F3F4F6; border-radius: 12px 12px 0 0; padding: 4px 4px 0; }
        .admin-tab { flex: 1; padding: 14px 20px; text-align: center; font-size: 14px; font-weight: 700; color: #6B7280; background: transparent; border: none; cursor: pointer; border-radius: 10px 10px 0 0; transition: all 0.2s; }
        .admin-tab.active { background: #fff; color: #004DA6; box-shadow: 0 -2px 8px rgba(0,0,0,0.06); }
        .admin-tab:hover:not(.active) { color: #374151; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .tab-panel { background: #fff; border-radius: 0 0 16px 16px; }
        /* ì¼ë ¨ë²ˆí˜¸ ë§í¬ */
        .serial-link { color: #004DA6; font-weight: 800; text-decoration: none; cursor: pointer; }
        .serial-link:hover { text-decoration: underline; color: #003D7A; }
        /* ë¬¸ì˜ í…Œì´ë¸” */
        .inquiry-text { max-width: 300px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; font-size: 13px; color: #374151; }
        .inquiry-full { white-space: normal; max-width: none; }
        /* ë¡œê·¸ì¸ í™”ë©´ */
        .admin-login-overlay {
            position: fixed; inset: 0; z-index: 10000;
            background: linear-gradient(135deg, #0F1A2E 0%, #1a1a2e 100%);
            display: flex; align-items: center; justify-content: center;
        }
        .admin-login-card {
            background: #fff; border-radius: 20px; padding: 48px 40px; text-align: center;
            max-width: 400px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        .admin-login-card .login-icon { font-size: 48px; margin-bottom: 16px; }
        .admin-login-card h2 { font-size: 22px; font-weight: 800; color: #1F2937; margin-bottom: 8px; }
        .admin-login-card p { font-size: 14px; color: #6B7280; margin-bottom: 28px; }
        .admin-login-card input[type="password"] {
            width: 100%; padding: 14px 16px; border: 2px solid #E5E7EB; border-radius: 12px;
            font-size: 16px; text-align: center; letter-spacing: 4px; outline: none;
            transition: border-color 0.3s;
        }
        .admin-login-card input[type="password"]:focus { border-color: #004DA6; }
        .admin-login-card input[type="password"].error { border-color: #E17055; animation: shake 0.4s; }
        .admin-login-card .login-btn {
            display: block; width: 100%; margin-top: 16px; padding: 14px;
            background: linear-gradient(135deg, #004DA6, #008F72); color: #fff;
            border: none; border-radius: 12px; font-size: 15px; font-weight: 700;
            cursor: pointer; transition: opacity 0.3s;
        }
        .admin-login-card .login-btn:hover { opacity: 0.9; }
        .admin-login-card .login-error { color: #E17055; font-size: 13px; margin-top: 12px; display: none; }
        @keyframes shake {
            0%,100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }
        @media (max-width: 768px) {
            .admin-table-wrap { overflow-x: auto; }
            .modal-info-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header" id="header">
        <div class="header-container">
            <a href="../index.html" class="logo">
                <span class="logo-icon">ğŸ§¬</span>
                <span class="logo-text">RegenMed<span class="logo-highlight">Consulting</span></span>
            </a>
            <nav class="nav">
                <a href="why-us.html" class="nav-link">ì™œ ìš°ë¦¬ì¸ê°€</a>
                <div class="nav-dropdown">
                    <a href="services.html" class="nav-link">ì„œë¹„ìŠ¤ <span class="nav-arrow">â–¾</span></a>
                    <div class="nav-dropdown-menu">
                        <a href="services.html" class="dropdown-link">ì„œë¹„ìŠ¤ ì†Œê°œ</a>
                        <a href="diagnosis.html" class="dropdown-link">ë¹„ì¦ˆë‹ˆìŠ¤ ì§„ë‹¨</a>
                        <a href="results.html" class="dropdown-link">ì§„ë‹¨ ê²°ê³¼ ë³´ê¸°</a>
                    </div>
                </div>
                <a href="process.html" class="nav-link">í”„ë¡œì„¸ìŠ¤</a>
                <a href="expertise.html" class="nav-link">ì „ë¬¸ë¶„ì•¼</a>
                <a href="requirements.html" class="nav-link">ì‹œì„¤ìš”ê±´</a>
                <a href="contact.html" class="nav-link nav-cta">ë¬´ë£Œìƒë‹´</a>
            </nav>
            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <div class="mobile-menu" id="mobileMenu">
        <a href="why-us.html" class="mobile-nav-link">ì™œ ìš°ë¦¬ì¸ê°€</a>
        <a href="services.html" class="mobile-nav-link">ì„œë¹„ìŠ¤</a>
        <a href="diagnosis.html" class="mobile-nav-link mobile-sub-link">â†³ ë¹„ì¦ˆë‹ˆìŠ¤ ì§„ë‹¨</a>
        <a href="results.html" class="mobile-nav-link mobile-sub-link">â†³ ì§„ë‹¨ ê²°ê³¼ ë³´ê¸°</a>
        <a href="process.html" class="mobile-nav-link">í”„ë¡œì„¸ìŠ¤</a>
        <a href="expertise.html" class="mobile-nav-link">ì „ë¬¸ë¶„ì•¼</a>
        <a href="requirements.html" class="mobile-nav-link">ì‹œì„¤ìš”ê±´</a>
        <a href="contact.html" class="mobile-nav-link">ë¬´ë£Œìƒë‹´ ì‹ ì²­</a>
    </div>

    <!-- ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ -->
    <div class="admin-login-overlay" id="loginOverlay">
        <div class="admin-login-card">
            <div class="login-icon">ğŸ”’</div>
            <h2>ê´€ë¦¬ì ì¸ì¦</h2>
            <p>ëŒ€ì‹œë³´ë“œì— ì ‘ê·¼í•˜ë ¤ë©´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”</p>
            <form id="loginForm">
                <input type="password" id="adminPw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" autocomplete="off" autofocus>
                <button type="submit" class="login-btn">í™•ì¸</button>
                <p class="login-error" id="loginError">ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤</p>
            </form>
        </div>
    </div>

    <div class="admin-container" id="adminContainer" style="display:none;">
        <div class="admin-header">
            <h1>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
            <p>ì§„ë‹¨ ì‹ ì²­ì ì •ë³´ ë° ê²°ê³¼ë¥¼ í™•ì¸í•©ë‹ˆë‹¤</p>
        </div>

        <div class="admin-stats" id="adminStats">
            <div class="stat-card">
                <div class="stat-label">ì´ ì§„ë‹¨ ê±´ìˆ˜</div>
                <div class="stat-value" id="statTotal">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Aë“±ê¸‰ (80ì  ì´ìƒ)</div>
                <div class="stat-value" id="statA" style="color:#00B894">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Bë“±ê¸‰ (60~79ì )</div>
                <div class="stat-value" id="statB" style="color:#FDCB6E">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Cë“±ê¸‰ (60ì  ë¯¸ë§Œ)</div>
                <div class="stat-value" id="statC" style="color:#E17055">0</div>
            </div>
        </div>

        <div class="admin-table-wrap">
            <div class="admin-tabs">
                <button class="admin-tab active" data-tab="tab1">AI ë¶„ì„ ë¦¬í¬íŠ¸</button>
                <button class="admin-tab" data-tab="tab2">ë¬¸ì˜ì‚¬í•­</button>
            </div>

            <!-- íƒ­1: AI ë¶„ì„ ë¦¬í¬íŠ¸ -->
            <div class="tab-content tab-panel active" id="tab1">
                <div class="admin-table-header">
                    <h2>AI ë¶„ì„ ë¦¬í¬íŠ¸ ëª©ë¡</h2>
                    <button class="btn-clear-data" onclick="if(confirm('ëª¨ë“  ì§„ë‹¨ ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')){localStorage.removeItem('diagnosisHistory');location.reload();}">ì „ì²´ ì‚­ì œ</button>
                </div>
                <div style="overflow-x:auto;">
                    <table class="admin-table" id="reportTable" style="display:none;">
                        <thead>
                            <tr>
                                <th>ì¼ë ¨ë²ˆí˜¸</th>
                                <th>ë‚ ì§œ</th>
                                <th>ì„±í•¨</th>
                                <th>ë³‘ì›/ê¸°ê´€</th>
                                <th>ì´ì </th>
                                <th>ë“±ê¸‰</th>
                                <th>P1 ì…ì§€</th>
                                <th>P2 ì‹œì„¤</th>
                                <th>P3 ìš´ì˜</th>
                            </tr>
                        </thead>
                        <tbody id="reportBody"></tbody>
                    </table>
                    <div class="no-data" id="noDataReport">ì§„ë‹¨ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
            </div>

            <!-- íƒ­2: ë¬¸ì˜ì‚¬í•­ -->
            <div class="tab-content tab-panel" id="tab2">
                <div class="admin-table-header">
                    <h2>ë¬¸ì˜ì‚¬í•­ ëª©ë¡</h2>
                </div>
                <div style="overflow-x:auto;">
                    <table class="admin-table" id="inquiryTable" style="display:none;">
                        <thead>
                            <tr>
                                <th>ì¼ë ¨ë²ˆí˜¸</th>
                                <th>ë‚ ì§œ</th>
                                <th>ì„±í•¨</th>
                                <th>ì—°ë½ì²˜</th>
                                <th>ì´ë©”ì¼</th>
                                <th>ë¬¸ì˜ë‚´ìš©</th>
                                <th>ìƒì„¸</th>
                            </tr>
                        </thead>
                        <tbody id="inquiryBody"></tbody>
                    </table>
                    <div class="no-data" id="noDataInquiry">ë¬¸ì˜ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                </div>
            </div>
        </div>
    </div>

    <!-- ìƒì„¸ ëª¨ë‹¬ -->
    <div class="admin-modal-overlay" id="detailModal">
        <div class="admin-modal">
            <h3 id="modalTitle">ì§„ë‹¨ ìƒì„¸ ì •ë³´</h3>
            <div class="modal-info-grid" id="modalInfo"></div>
            <div class="modal-score-section" id="modalScores"></div>
            <div class="modal-note" id="modalNote" style="display:none;"></div>
            <button class="modal-close" onclick="document.getElementById('detailModal').classList.remove('active')">ë‹«ê¸°</button>
        </div>
    </div>

    <script src="../js/supabase.js"></script>
    <script src="../script.js"></script>
    <script>
    // ë¹„ë°€ë²ˆí˜¸ ì¸ì¦
    (function() {
        var overlay = document.getElementById('loginOverlay');
        var container = document.getElementById('adminContainer');
        var pwInput = document.getElementById('adminPw');
        var errorMsg = document.getElementById('loginError');
        var PASS = '963314';

        // ì´ë¯¸ ì¸ì¦ëœ ì„¸ì…˜ì´ë©´ ë°”ë¡œ í‘œì‹œ
        if (sessionStorage.getItem('adminAuth') === 'true') {
            overlay.style.display = 'none';
            container.style.display = 'block';
        }

        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            if (pwInput.value === PASS) {
                sessionStorage.setItem('adminAuth', 'true');
                overlay.style.display = 'none';
                container.style.display = 'block';
            } else {
                pwInput.classList.add('error');
                errorMsg.style.display = 'block';
                setTimeout(function() { pwInput.classList.remove('error'); }, 400);
                pwInput.value = '';
                pwInput.focus();
            }
        });
    })();

    (function() {
        // íƒ­ ì „í™˜
        document.querySelectorAll('.admin-tab').forEach(function(tab) {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.admin-tab').forEach(function(t) { t.classList.remove('active'); });
                document.querySelectorAll('.tab-content').forEach(function(c) { c.classList.remove('active'); });
                tab.classList.add('active');
                document.getElementById(tab.getAttribute('data-tab')).classList.add('active');
            });
        });

        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ ë‹«ê¸°
        document.getElementById('detailModal').addEventListener('click', function(e) {
            if (e.target === this) this.classList.remove('active');
        });

        function serialNo(id) {
            return String(id).padStart(4, '0');
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            var d = new Date(dateStr);
            return d.getFullYear() + '.' + String(d.getMonth()+1).padStart(2,'0') + '.' + String(d.getDate()).padStart(2,'0');
        }

        // === Supabaseì—ì„œ ì§„ë‹¨ ë°ì´í„° ë¡œë“œ (íƒ­1) ===
        supabaseFetchDiagnoses().then(function(diagnoses) {
            document.getElementById('statTotal').textContent = diagnoses.length;
            var a = 0, b = 0, c = 0;
            diagnoses.forEach(function(r) {
                if (r.pct >= 80) a++;
                else if (r.pct >= 60) b++;
                else c++;
            });
            document.getElementById('statA').textContent = a;
            document.getElementById('statB').textContent = b;
            document.getElementById('statC').textContent = c;

            if (diagnoses.length === 0) return;

            document.getElementById('reportTable').style.display = 'table';
            document.getElementById('noDataReport').style.display = 'none';

            var reportBody = document.getElementById('reportBody');
            diagnoses.forEach(function(r) {
                var tr = document.createElement('tr');
                var pct = r.pct;
                var gradeClass = pct >= 80 ? 'grade-a' : pct >= 60 ? 'grade-b' : 'grade-c';
                var gradeName = pct >= 80 ? 'A' : pct >= 60 ? 'B' : 'C';
                var barColor = pct >= 80 ? '#00B894' : pct >= 60 ? '#FDCB6E' : '#E17055';

                function miniBar(score) {
                    var p = (score / 50) * 100;
                    var mc = p >= 80 ? '#00B894' : p >= 60 ? '#FDCB6E' : '#E17055';
                    return '<span class="score-bar-mini"><span class="score-bar-mini-fill" style="width:' + p + '%;background:' + mc + '"></span></span>' + score + '/50';
                }

                tr.innerHTML =
                    '<td><a class="serial-link" href="results.html?id=' + r.id + '">' + serialNo(r.id) + '</a></td>' +
                    '<td>' + formatDate(r.created_at) + '</td>' +
                    '<td><strong>' + (r.name || '-') + '</strong></td>' +
                    '<td>' + (r.hospital || '-') + '</td>' +
                    '<td><span class="score-bar-mini"><span class="score-bar-mini-fill" style="width:' + pct + '%;background:' + barColor + '"></span></span>' + pct + 'ì </td>' +
                    '<td><span class="grade-tag ' + gradeClass + '">' + gradeName + 'ë“±ê¸‰</span></td>' +
                    '<td>' + miniBar(r.scores_p1) + '</td>' +
                    '<td>' + miniBar(r.scores_p2) + '</td>' +
                    '<td>' + miniBar(r.scores_p3) + '</td>';
                reportBody.appendChild(tr);
            });

            // ì§„ë‹¨ ë°ì´í„° ì¤‘ noteê°€ ìˆëŠ” ê²ƒì€ ë¬¸ì˜ íƒ­ì—ë„ í‘œì‹œ
            var hasInquiry = false;
            var inquiryBody = document.getElementById('inquiryBody');
            diagnoses.forEach(function(r) {
                var note = r.note || '';
                if (!note.trim()) return;
                hasInquiry = true;
                var tr = document.createElement('tr');
                tr.innerHTML =
                    '<td><a class="serial-link" href="results.html?id=' + r.id + '">' + serialNo(r.id) + '</a></td>' +
                    '<td>' + formatDate(r.created_at) + '</td>' +
                    '<td><strong>' + (r.name || '-') + '</strong></td>' +
                    '<td>' + (r.phone || '-') + '</td>' +
                    '<td>' + (r.email || '-') + '</td>' +
                    '<td><div class="inquiry-text">' + note + '</div></td>' +
                    '<td><button class="detail-btn" data-id="' + r.id + '">ìƒì„¸</button></td>';
                inquiryBody.appendChild(tr);
            });

            // Supabaseì—ì„œ ë¬¸ì˜ì‚¬í•­(contact form) ë°ì´í„°ë„ ë¡œë“œ
            supabaseFetchInquiries().then(function(inquiries) {
                inquiries.forEach(function(q) {
                    hasInquiry = true;
                    var tr = document.createElement('tr');
                    tr.innerHTML =
                        '<td>C' + String(q.id).padStart(4, '0') + '</td>' +
                        '<td>' + formatDate(q.created_at) + '</td>' +
                        '<td><strong>' + (q.name || '-') + '</strong></td>' +
                        '<td>' + (q.phone || '-') + '</td>' +
                        '<td>' + (q.email || '-') + '</td>' +
                        '<td><div class="inquiry-text">' + (q.message || '') + '</div></td>' +
                        '<td><span style="color:#999;font-size:12px;">ë¬¸ì˜í¼</span></td>';
                    inquiryBody.appendChild(tr);
                });
                if (hasInquiry) {
                    document.getElementById('inquiryTable').style.display = 'table';
                    document.getElementById('noDataInquiry').style.display = 'none';
                }
            });

            // ìƒì„¸ ëª¨ë‹¬
            inquiryBody.addEventListener('click', function(e) {
                if (!e.target.classList.contains('detail-btn')) return;
                var rid = parseInt(e.target.getAttribute('data-id'));
                var r = diagnoses.find(function(d) { return d.id === rid; });
                if (!r) return;

                document.getElementById('modalTitle').textContent = serialNo(r.id) + ' ' + (r.name || 'ë¯¸ì…ë ¥') + ' - ìƒì„¸ ì •ë³´';

                var infoHtml =
                    '<div class="modal-info-item"><div class="label">ì„±í•¨</div><div class="value">' + (r.name || '-') + '</div></div>' +
                    '<div class="modal-info-item"><div class="label">ì§í•¨</div><div class="value">' + (r.position || '-') + '</div></div>' +
                    '<div class="modal-info-item"><div class="label">ì—°ë½ì²˜</div><div class="value">' + (r.phone || '-') + '</div></div>' +
                    '<div class="modal-info-item"><div class="label">ì´ë©”ì¼</div><div class="value">' + (r.email || '-') + '</div></div>' +
                    '<div class="modal-info-item"><div class="label">ë³‘ì›/ê¸°ê´€</div><div class="value">' + (r.hospital || '-') + '</div></div>' +
                    '<div class="modal-info-item"><div class="label">ì†Œì¬ì§€</div><div class="value">' + (r.location || '-') + '</div></div>';
                document.getElementById('modalInfo').innerHTML = infoHtml;

                function partBar(label, score) {
                    var p = (score / 50) * 100;
                    var c2 = p >= 80 ? '#00B894' : p >= 60 ? '#FDCB6E' : '#E17055';
                    return '<div class="modal-part-row"><span class="modal-part-label">' + label + '</span><div class="modal-part-bar"><div class="modal-part-bar-fill" style="width:' + p + '%;background:' + c2 + '"></div></div><span class="modal-part-score">' + score + '/50</span></div>';
                }
                var scoresHtml = '<h4>ì´ì : ' + r.pct + 'ì </h4>' +
                    partBar('PART 1. ì…ì§€/ìˆ˜ìµì„±', r.scores_p1) +
                    partBar('PART 2. ì‹œì„¤/ì—”ì§€ë‹ˆì–´ë§', r.scores_p2) +
                    partBar('PART 3. ìš´ì˜/íŒ€ë¹Œë”©', r.scores_p3);
                document.getElementById('modalScores').innerHTML = scoresHtml;

                var noteEl = document.getElementById('modalNote');
                if (r.note) {
                    noteEl.style.display = 'block';
                    noteEl.textContent = 'ë¬¸ì˜ë‚´ìš©: ' + r.note;
                } else {
                    noteEl.style.display = 'none';
                }

                document.getElementById('detailModal').classList.add('active');
            });
        });
    })();
    </script>
</body>
</html>
